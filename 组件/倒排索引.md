## 倒排索引

https://www.elastic.co/guide/cn/elasticsearch/guide/2.x/inverted-index.html

https://developer.aliyun.com/article/38228

个倒排索引由文档中所有不重复词的列表构成，对于其中每个词，有一个包含它的文档列表

![](./pic/倒排索引.png)

![倒排索引1](./pic/倒排索引1.jpg)

- 属性值来确定记录的位置
- 一般表示为一个关键词，然后是它的频度（出现的次数），位置（出现在哪一篇文章或网页中，及有关的日期，作者等信息
- 倒排索引由两个部分组成：单词词典和倒排文件

### 单词词典

单词词典是由文档集合中出现过的所有单词构成的字符串集合，单词词典内每条索引项记载单词本身的一些信息以及指向“倒排列表”的指针

常用的数据结构包含哈希加链表和树形词典结构

### 倒排文件

所有单词的倒排列表顺序的存储在磁盘的某个文件里，这个文件即被称为倒排文件，倒排文件是存储倒排索引的物理文件。

### 分词处理：

文章1的内容为：Tom lives in Guangzhou,I live in Guangzhou too. 　　

文章2的内容为：He once lived in Shanghai.

- 我们现在有的是文章内容，即一个字符串，我们先要找出字符串中的所有单词，即分词。英文单词由于用空格分隔，比较好处理。中文单词间是连在一起的需要特殊的分词处理
- 文章中的”in”, “once” “too”等词没有什么实际意义，中文中的“的”“是”等字通常也无具体含义，这些不代表概念的词可以过滤掉 
- 用户通常希望查“He”时能把含“he”，“HE”的文章也找出来，所以所有单词需要统一大小写
- 用户通常希望查“live”时能把含“lives”，“lived”的文章也找出来，所以需要把“lives”，“lived”还原成“live” 　

> 索引文本和查询字符串必须标准化为相同的格式。

### 分析与分析器

*分析* 包含下面的过程：

- 首先，将一块文本分成适合于倒排索引的独立的 *词条* ，
- 之后，将这些词条统一化为标准格式以提高它们的“可搜索性”，或者 *recall*

分析器执行上面的工作。 *分析器* 实际上是将三个功能封装到了一个包里：

**字符过滤器**：在分词前整理字符串。一个字符过滤器可以用来去掉HTML，或者将 `&` 转化成 `and`

**分词器**： 字符串被 *分词器* 分为单个的词条。一个简单的分词器遇到空格和标点的时候，可能会将文本拆分成词条

**Token 过滤器**：词条按顺序通过每个 *token 过滤器* 。这个过程可能会改变词条（例如，小写化 `Quick` ），删除词条（例如， 像 `a`， `and`， `the` 等无用词），或者增加词条（例如，像 `jump` 和 `leap` 这种同义词）。